<?php
/*
    MoM Server Replacement Project
    Copyright (c) 2024 RFC1920 <desolationoutpostpve@gmail.com>

    This program is free software; you can redistribute it and/or
    modify it under the terms of the GNU General Public License v2.0.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program; if not, write to the Free Software
    Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.

    Optionally you can also view the license at <http://www.gnu.org/licenses/>.
*/
	include(dirname(__DIR__) . "/Prod/config/mars.inc.php");

	if(!@is_array($_POST)) exit;
	if(!@str_starts_with($_SERVER['HTTP_USER_AGENT'], "Game/1.1.8.114912")) exit;

	$jsonString = file_get_contents("php://input");
	$resp = json_decode($jsonString, false);

	$serverid = $resp->Settings->MARS_SERVERID->Value;
	EditServer($serverid, $resp->IpAddress, $resp->Port);
	$resp->SessionId = GetSessionId($serverid);
	$resp->IpAddress = $_SERVER['REMOTE_ADDR'];

	$json = json_encode($resp, false);

	header('Content-Type: application/json; charset=utf-8');
	header("Content-Length: " . strlen($json));
	echo $json;
?>
