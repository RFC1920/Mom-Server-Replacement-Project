<?php
/*
    MoM Server Replacement Project
    Copyright (c) 2024 RFC1920 <desolationoutpostpve@gmail.com>

    This program is free software; you can redistribute it and/or
    modify it under the terms of the GNU General Public License v2.0.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program; if not, write to the Free Software
    Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.

    Optionally you can also view the license at <http://www.gnu.org/licenses/>.
*/

	if(!@str_starts_with($_SERVER['HTTP_USER_AGENT'], "Game/1.1.8.114912")) exit;
	if(!@htmlspecialchars($_GET["platform"]) == "STEAM") exit;
	if(!@htmlspecialchars($_GET["build"]) == "114912") exit;


	include(dirname(__DIR__) . "/Prod/config/mars.inc.php");

	$servers = GetAllServers();

	$json = json_encode($servers);
	file_put_contents("/tmp/getall", $json);

	$json = <<< EOF
[
    {
        "SessionId": "0",
        "NumPublicConnections": 0,
        "NumPrivateConnections": 0,
        "ShouldAdvertise": false,
        "AllowJoinInProgress": true,
        "IsLANMatch": false,
        "IsDedicated": true,
        "UsesStats": false,
        "AllowInvites": true,
        "UsesPresence": false,
        "AllowJoinViaPresence": true,
        "AllowJoinViaPresenceFriendsOnly": false,
        "AntiCheatProtected": false,
        "BuildUniqueId": "114912",
        "OwningUserName": ""
    },
    {
        "SessionId": "38",
        "NumPublicConnections": 2,
        "NumPrivateConnections": 0,
        "ShouldAdvertise": false,
        "AllowJoinInProgress": true,
        "IsLANMatch": false,
        "IsDedicated": true,
        "UsesStats": false,
        "AllowInvites": true,
        "UsesPresence": false,
        "AllowJoinViaPresence": true,
        "AllowJoinViaPresenceFriendsOnly": false,
        "AntiCheatProtected": false,
        "BuildUniqueId": "114912",
        "OwningUserName": "rfcmom",
        "Settings": {
            "MapName": {
                "Type": "String",
                "Value": "Untitled_0"
            },
            "MARS_SERVERID": {
                "Type": "String",
                "Value": "mom_rfc_01"
            },
            "LIMBIC_TARGET_PLATFORMS": {
                "Type": "String",
                "Value": "steam"
            },
            "MARS_AUDIENCE": {
                "Type": "String",
                "Value": "MoM"
            },
            "MARS_GAMESERVER_MODE": {
                "Type": "String",
                "Value": "PVE"
            },
            "MARS_GAMESERVER_TYPE": {
                "Type": "Bool",
                "Value": true
            },
            "Password": {
                "Type": "Bool",
                "Value": true
            }
        }
    }
]
EOF;
	header('Content-Type: application/json; charset=utf-8');
	header("Content-Length: " . strlen($json));
	//echo $json;

	echo $json;
?>
